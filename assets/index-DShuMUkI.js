import{r as p,j as e,a as G}from"./react-Tf5a63N3.js";import{c as K}from"./react-dom-L-9RVvDo.js";import{L as V,B as W}from"./react-router-dom-MFmCInc-.js";import{A as F,a as h,B as j,b as _,S as C,F as u,I as R,D as B,c as E,d as X,R as J,C as g,T as Z,L as k,P as U,e as Q,z as ee}from"./antd-47VLvnxT.js";import{O as te,d as se,e as P}from"./react-router-_w-FNBej.js";import{u as re,a as L,b as ae}from"./ahooks-Y0YILfgT.js";import{L as ne}from"./rc-virtual-list-ndp4EOBa.js";import{d as b}from"./dayjs-I44_pL56.js";import{c as oe}from"./@wxcloud-VArnRXkh.js";import{a as ie}from"./axios-L6U4YIEh.js";import{l as de}from"./lodash-xRwbkVY_.js";import{C as m}from"./crypto-js-cnNLbfBj.js";import{Z as le,m as ce,c as he,u as me}from"./@wangeditor-gzx6jVfq.js";import{D as ue}from"./@ant-design-Aq87BQXm.js";import"./@babel-fXcOJB-X.js";import"./scheduler-iwWdm5Ml.js";import"./@remix-run-aZQYQeYp.js";import"./rc-util-MuZmlthd.js";import"./react-is-q81m-9gd.js";import"./classnames-RRvKwVVO.js";import"./rc-resize-observer-EvetPw9M.js";import"./resize-observer-polyfill-B32NGzNS.js";import"./rc-motion-US3v7rSN.js";import"./rc-overflow-5c684BAk.js";import"./rc-picker-OaRgW5pO.js";import"./@rc-component-GVPyGy1S.js";import"./rc-menu-llqNlVpY.js";import"./rc-select-1Y2qwDsG.js";import"./@ctrl-_Y40OLZn.js";import"./rc-drawer-jstnhiOO.js";import"./rc-field-form-iBbHa6wp.js";import"./async-validator-BHjhHa7C.js";import"./rc-notification-JATChWhP.js";import"./rc-tooltip-jSjB7CjI.js";import"./rc-table-QWXOqrV0.js";import"./rc-tree-xwD5Y_7G.js";import"./rc-checkbox-WSXnycII.js";import"./rc-pagination-QHC3hAwc.js";import"./rc-dropdown-OIa4IJqi.js";import"./throttle-debounce-5p4B7Tol.js";import"./rc-input-rx7E-1zV.js";import"./rc-textarea-qr8GBR_c.js";import"./tslib-9i2l26Ba.js";import"./@emotion-folQEnri.js";import"./stylis-3miXmfPm.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function i(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=i(o);fetch(o.href,a)}})();const H={loading:!1,list:[],tags:[]},pe=(t,s)=>{switch(s.type){case"UPDATE":return{...t,...s.payload||{}};default:return t}},w=p.createContext({state:H,dispatch:()=>{}}),{Content:xe}=F,fe=()=>e.jsx(F,{className:"ndzy-layout",children:e.jsx(xe,{children:e.jsx("div",{className:"layout-content",children:e.jsx(te,{})})})}),ye=oe.initCloud(),$=ye.Cloud({identityless:!0,resourceAppid:"wxf18966ace3bbbd97",resourceEnv:"prod-3gjeiq7x1fbed11e"});$.init();const je=t=>Object.keys(t).map(s=>t[s]?`${encodeURIComponent(s)}=${encodeURIComponent(t[s])}`:"").filter(s=>s).join("&"),ge=t=>{const{url:s="",data:i={},params:n={}}=t;let o=s;const a=localStorage.getItem("token"),d={"X-WX-SERVICE":"ndzy-service"};return a&&(d.Authorization="Basic "+a),t.method==="GET"&&!de.isEmpty(n)&&(o+="?"+je(n)),new Promise((f,c)=>{$.callContainer({...t,config:{env:"prod-3gjeiq7x1fbed11e"},path:o,header:d,method:t.method,data:i}).then(r=>{(r==null?void 0:r.statusCode)===401&&(window.location.href=`https://ndzy01.gitee.io/ndzy-login/?url=${window.location.href}`),r.data.status===1&&h.error(r.data.msg),r.data.status===0&&h.success(r.data.msg),f(r.data)}).catch(()=>{c("网络错误")})})},O=ie.create({baseURL:"http://localhost:3000",timeout:6e4,withCredentials:!1});O.interceptors.request.use(t=>{const s=localStorage.getItem("token");return s&&(t.headers={Authorization:"Basic "+s}),t},t=>{Promise.reject(t)});O.interceptors.response.use(t=>{const s=t.data;return t.data.status===1&&h.error(t.data.msg),t.data.status===0&&h.success(t.data.msg),s},t=>{let s="";if(t&&t.response)switch(t.response.status){case 302:s="接口重定向了！",h.error(s);break;case 400:s="参数不正确！",h.error(s);break;case 401:s="您未登录，或者登录已经超时，请先登录！",window.location.href=`https://ndzy01.gitee.io/ndzy-login/?url=${window.location.href}`;break;case 403:s="您没有权限操作！",h.error(s);break;case 404:s=`请求地址出错: ${t.response.config.url}`,h.error(s);break;case 408:s="请求超时！",h.error(s);break;case 409:s="系统已存在相同数据！",h.error(s);break;case 500:s="服务器内部错误！",h.error(s);break;case 501:s="服务未实现！",h.error(s);break;case 502:s="网关错误！",h.error(s);break;case 503:s="服务不可用！",h.error(s);break;case 504:s="服务暂时无法访问，请稍后再试！",h.error(s);break;case 505:s="HTTP 版本不受支持！",h.error(s);break;default:s="异常问题，请联系管理员！",h.error(s);break}return Promise.reject(s)});const T=ge,be=t=>t&&t<b().endOf("day"),z=()=>{let t=new Date().getTime();return typeof performance<"u"&&typeof performance.now=="function"&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const n=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?n:n&3|8).toString(16)})},v=()=>{let t="";for(let s=0;s<8;s++)t+=z().replace(/-/g,"");return t},Te=(t,s,i)=>{const n=m.enc.Utf8.parse(s),o=m.enc.Utf8.parse(i),a=m.enc.Hex.parse(t),d=m.enc.Base64.stringify(a);return m.AES.decrypt(d,n,{iv:o,mode:m.mode.CBC,padding:m.pad.Pkcs7,hasher:m.algo.SHA256}).toString(m.enc.Utf8).toString()},Y=t=>{const s=v(),i=v(),n=m.enc.Utf8.parse(s),o=m.enc.Utf8.parse(i),a=m.enc.Utf8.parse(t),d=m.AES.encrypt(a,n,{iv:o,mode:m.mode.CBC,padding:m.pad.Pkcs7,hasher:m.algo.SHA256});return{keyBase:s,ivBase:i,text:d.ciphertext.toString().toUpperCase()}},Ce={labelCol:{xs:{span:6},sm:{span:6}},wrapperCol:{xs:{span:18},sm:{span:18}}},S=()=>{const{dispatch:t}=p.useContext(w),s=()=>{t({type:"UPDATE",payload:{loading:!0}}),T({url:"/users/loginInfo",method:"GET"}).then(r=>{t({type:"UPDATE",payload:{user:r.data,loading:!1}})}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},i=()=>{t({type:"UPDATE",payload:{loading:!0}}),T({url:"/tags",method:"GET"}).then(r=>{t({type:"UPDATE",payload:{tags:r.data,loading:!1}})}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},n=(r={})=>{t({type:"UPDATE",payload:{loading:!0}}),T({url:"/todos",method:"GET",params:r}).then(y=>{t({type:"UPDATE",payload:{list:y.data.map(l=>({...l,detail:Te(l.detail,l.keyBase,l.ivBase)})),loading:!1}})}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})};return{initUser:s,initTags:i,createTodo:(r,y)=>{t({type:"UPDATE",payload:{loading:!0}});const{text:l,keyBase:x,ivBase:D}=Y(r.detail);T({url:"/todos",method:"POST",data:{...r,deadline:b(r.deadline).format("YYYY-MM-DD"),operationSource:"h5",detail:l,keyBase:x,ivBase:D}}).then(()=>{t({type:"UPDATE",payload:{loading:!1}}),n(),y&&y()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},editTodo:(r,y,l)=>{t({type:"UPDATE",payload:{loading:!0}});const{text:x,keyBase:D,ivBase:q}=Y(r.detail);T({url:`/todos/${y.id}`,method:"PATCH",data:{name:r.name,detail:x,keyBase:D,ivBase:q,deadline:b(r.deadline).format("YYYY-MM-DD"),tagId:r.tagId}}).then(()=>{t({type:"UPDATE",payload:{loading:!1}}),n(),l&&l()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},getAllTodo:n,finishTodo:r=>{t({type:"UPDATE",payload:{loading:!0}}),T({url:`/todos/${r.id}`,method:"PATCH",data:{isFinish:!0}}).then(()=>{n()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},delTodo:r=>{t({type:"UPDATE",payload:{loading:!0}}),T({url:`/todos/${r.id}`,method:"DELETE",data:{isFinish:!0}}).then(()=>{n()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},recoverTodo:r=>{t({type:"UPDATE",payload:{loading:!0}}),T({url:`/todos/${r.id}`,method:"PATCH",data:{isFinish:!1}}).then(()=>{n()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})}}},we=({children:t,...s})=>p.isValidElement(t)?p.cloneElement(t,{...s}):t,A=({title:t,btnName:s,children:i,type:n="link",...o})=>{const[a,d]=re({open:!1});return e.jsxs(e.Fragment,{children:[e.jsx(j,{type:n,onClick:()=>d({open:!0}),children:s}),e.jsx(_,{destroyOnClose:!0,open:a.open,title:t,placement:"right",width:"100%",onClose:()=>d({open:!1}),children:e.jsx(we,{onClose:()=>d({open:!1}),...o,children:a&&i})})]})},M=t=>e.jsxs(A,{title:"查看",btnName:"查看",children:[e.jsx("div",{style:{padding:"0 8px"},id:`preview-${z()}`,className:"ndzy-preview",dangerouslySetInnerHTML:{__html:t.detail}}),e.jsx("div",{children:e.jsxs(C,{children:[e.jsxs("span",{style:{color:"blue"},children:["创建人：",t.userName||"--"]}),e.jsxs("span",{style:{color:"green"},children:["标签：",t.tagName||"--"]}),e.jsxs("span",{style:{color:"red"},children:["终止日期：",b(t.deadline).format("YYYY-MM-DD")]})]})}),e.jsx("div",{children:e.jsxs(C,{children:[e.jsxs("span",{children:["创建日期：",b(t.createdAt).subtract(8,"h").format("YYYY-MM-DD")]}),e.jsxs("span",{children:["更新日期：",b(t.updatedAt).subtract(8,"h").format("YYYY-MM-DD")]})]})})]});le.registerModule(ce);function Ee({value:t,onChange:s,showToolbar:i=!0}){const[n,o]=p.useState(null),[a,d]=p.useState(""),f={},c={placeholder:"请输入内容..."};return p.useEffect(()=>{d(t)},[t]),p.useEffect(()=>()=>{n!=null&&(n.destroy(),o(null))},[n]),e.jsx(e.Fragment,{children:e.jsxs("div",{style:{border:"1px solid #ccc",zIndex:100,width:"100%"},children:[i&&e.jsx(he,{editor:n,defaultConfig:f,mode:"default",style:{borderBottom:"1px solid #ccc"}}),e.jsx(me,{defaultConfig:c,value:a,onCreated:o,onChange:r=>{d(r.getHtml()),s(r.getHtml())},mode:"default",style:{overflowY:"hidden",minHeight:330}})]})})}const N=t=>{const{createTodo:s,editTodo:i}=S(),{state:n}=p.useContext(w),o=a=>t.id?i(a,{id:t.id},t.onClose):s(a,t.onClose);return e.jsxs(u,{initialValues:{name:t.name,deadline:t.deadline?b(t.deadline):b(),detail:t.detail,tagId:t.tagId},preserve:!1,name:"edit",onFinish:o,scrollToFirstError:!0,children:[e.jsx(u.Item,{name:"name",label:"名称",rules:[{required:!0,message:"名称不能为空"}],children:e.jsx(R.TextArea,{rows:1})}),e.jsx(u.Item,{name:"deadline",label:"终止时间",rules:[{required:!0,message:"终止时间不能为空"}],children:e.jsx(B,{className:"w-100",format:"YYYY-MM-DD",disabledDate:be})}),e.jsx(u.Item,{name:"detail",label:"详情",rules:[{required:!0,message:"详情不能为空"}],children:e.jsx(Ee,{})}),e.jsx(u.Item,{name:"tagId",label:"标签",rules:[{required:!0,message:"请选择一个标签"}],children:e.jsx(E,{options:n.tags.map(a=>({label:`${a.name}-(${a.userName})`,value:a.id}))})}),e.jsx(u.Item,{children:e.jsx(X,{offsetBottom:16,children:e.jsx(j,{loading:n.loading,type:"primary",htmlType:"submit",children:t.id?"保存":"创建"})})})]})},{RangePicker:I}=B,Ae=()=>{const[t]=u.useForm(),s=p.useRef(null),i=L(s),{getAllTodo:n}=S(),{state:o}=p.useContext(w),a=Number(i==null?void 0:i.width)>800?8:24,[d,f]=p.useState(!1);return e.jsx("div",{ref:s,children:e.jsx(u,{form:t,...Ce,name:"search",onFinish:c=>{Object.keys(c).map(r=>{c[r]||delete c[r],(r==="createdRange"||r==="updatedRange"||r==="deadlineRange")&&c[r]&&(c[r]=JSON.stringify(c[r].map(y=>b(y).format("YYYY-MM-DD"))))}),n(c)},scrollToFirstError:!0,children:e.jsxs(J,{gutter:24,children:[e.jsx(g,{span:a,children:e.jsx(u.Item,{name:"name",label:"名称",children:e.jsx(R,{className:"w-100",allowClear:!0})})}),d&&e.jsxs(e.Fragment,{children:[e.jsx(g,{span:a,children:e.jsx(u.Item,{name:"tagId",label:"标签",children:e.jsx(E,{allowClear:!0,className:"w-100",options:o.tags.map(c=>({label:`${c.name}-(${c.userName})`,value:c.id}))})})}),e.jsx(g,{span:a,children:e.jsx(u.Item,{name:"operationSource",label:"来源",children:e.jsx(E,{allowClear:!0,className:"w-100",options:[{label:"h5",value:"h5"},{label:"微信",value:"wx"}]})})}),e.jsx(g,{span:a,children:e.jsx(u.Item,{name:"isFinish",label:"状态",children:e.jsx(E,{allowClear:!0,className:"w-100",options:[{label:"处理中",value:"0"},{label:"已完成",value:"1"}]})})}),e.jsx(g,{span:a,children:e.jsx(u.Item,{name:"deadlineRange",label:"截止时间",children:e.jsx(I,{style:{width:"100%"}})})}),e.jsx(g,{span:a,children:e.jsx(u.Item,{name:"createdRange",label:"创建时间",children:e.jsx(I,{style:{width:"100%"}})})}),e.jsx(g,{span:a,children:e.jsx(u.Item,{name:"updatedRange",label:"更新时间",children:e.jsx(I,{style:{width:"100%"}})})})]}),e.jsx(g,{span:a,children:e.jsxs(C,{children:[e.jsx(j,{loading:o.loading,type:"primary",htmlType:"submit",children:"搜索"}),e.jsx(j,{type:"link",onClick:()=>{t.resetFields(),n()},children:"重置"}),e.jsxs("a",{style:{fontSize:12},onClick:()=>{f(!d)},children:[e.jsx(ue,{rotate:d?180:0}),d?"收起":"展开"]})]})}),e.jsx(g,{span:a,children:e.jsxs(C,{children:[e.jsx(A,{title:"新建",btnName:"新建",children:e.jsx(N,{})}),e.jsx("div",{children:o.user?e.jsxs("div",{style:{minWidth:33},className:"sky-blue center",children:["用户：",o.user.name]}):e.jsx("div",{style:{minWidth:33},className:"sky-blue center",children:"用户：游客"})})]})})]})})})},De=()=>{const s=p.useRef(null),i=L(s),{state:n}=p.useContext(w),{initUser:o,initTags:a,getAllTodo:d,finishTodo:f,delTodo:c,recoverTodo:r}=S();ae(()=>{o(),a(),d()});const y=[{title:"名称",dataIndex:"name",width:80},{title:"进度",dataIndex:"deadline",width:100,render:(l,x)=>{if(Number(x.isFinish)===0)return e.jsx("span",{style:{color:"red"},children:"处理中"});if(Number(x.isFinish)===1)return e.jsx("span",{style:{color:"green"},children:"已完成"})}},{title:"截止日期",dataIndex:"deadline",width:100},{title:"标签",dataIndex:"tagName",width:100},{title:"用户",dataIndex:"userName",width:100},{title:"创建时间",dataIndex:"createdAt",width:100},{title:"更新时间",dataIndex:"updatedAt",width:100},{title:"操作",width:120,fixed:"right",render:(l,x)=>e.jsxs(C,{children:[e.jsx(M,{...x}),Number(x.isFinish)===0?e.jsxs(C,{children:[e.jsx(A,{title:"编辑",btnName:"编辑",...x,children:e.jsx(N,{})}),e.jsx(j,{type:"link",onClick:()=>f(x),children:"完成"})]}):Number(x.isFinish)===1?e.jsxs(C,{children:[e.jsx(j,{type:"link",onClick:()=>r(x),children:"恢复"}),e.jsx(U,{title:"删除将无法恢复,确定删除?",onConfirm:()=>c(x),children:e.jsx(j,{type:"link",children:" 删除"})})]}):null]})}];return e.jsxs("div",{ref:s,style:{height:"100%"},className:"p-16",children:[e.jsx(Ae,{}),Number(i==null?void 0:i.width)>800?e.jsx(Z,{loading:n.loading,virtual:!0,columns:y,scroll:{x:900,y:600},rowKey:"id",dataSource:n.list,pagination:!1,locale:{emptyText:e.jsx("div",{className:"center",children:"暂无待办事项"})}}):e.jsx(k,{loading:n.loading,children:e.jsx(ne,{data:n.list,height:600,itemHeight:40,itemKey:"id",children:l=>e.jsxs(k.Item,{actions:[e.jsx(M,{...l}),...Number(l.isFinish)===0?[e.jsx(A,{title:"编辑",btnName:"编辑",...l,children:e.jsx(N,{})}),e.jsx(j,{type:"link",onClick:()=>f(l),children:"完成"})]:[e.jsx(j,{type:"link",onClick:()=>r(l),children:"恢复"}),e.jsx(U,{title:"删除将无法恢复,确定删除?",onConfirm:()=>c(l),children:e.jsx(j,{type:"link",children:" 删除"})})],...Number(l.isFinish)===0?[]:[]],children:[e.jsx(k.Item.Meta,{title:l.name,description:l.deadline}),e.jsx("div",{children:Number(l.isFinish)===0&&e.jsx("span",{style:{color:"red"},children:"处理中"})}),e.jsx("div",{children:Number(l.isFinish)===1&&e.jsx("span",{style:{color:"green"},children:"已完成"})})]},l.id)})})]})},ke=()=>e.jsx("div",{className:"center",children:e.jsxs("div",{children:[e.jsx("h2",{children:"页面不存在"}),e.jsx("p",{children:e.jsx(V,{to:"/ndzy-todos/",children:"返回首页"})})]})}),Pe=()=>{const[t,s]=p.useReducer(pe,H);return e.jsx(Q,{locale:ee,children:e.jsx(w.Provider,{value:{state:t,dispatch:s},children:e.jsx(se,{children:e.jsxs(P,{path:"/ndzy-todos/",element:e.jsx(fe,{}),children:[e.jsx(P,{index:!0,element:e.jsx(De,{})}),e.jsx(P,{path:"*",element:e.jsx(ke,{})})]})})})})};K.createRoot(document.getElementById("root")).render(e.jsx(G.StrictMode,{children:e.jsx(W,{children:e.jsx(Pe,{})})}));
